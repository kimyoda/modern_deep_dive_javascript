# 9.4 단축 평가

---

## 9.4.1 논리 연산자를 사용한 단축 평가

논리합(`||`) 또는 논리곱(`&&`) 연산자 표현식의 평가 결과는 항상 불리언 값이 아닐 수도 있습니다. 두 개의 피연산자 중 어느 한쪽으로 평가될 수 있습니다.

### 예제 9-17

```js
"Cat" && "Dog"; // -> "Dog"
```

**설명:**

- 논리곱(`&&`) 연산자는 두 개의 피연산자가 모두 `true`로 평가될 때 `true`를 반환합니다.
- `"Cat"`은 Truthy 값으로 `true`로 평가됩니다. 하지만 두 번째 피연산자까지 평가해야 최종 결과를 결정할 수 있습니다.
- 논리곱 연산자는 **논리 연산의 결과를 결정하는 두 번째 피연산자인 문자열 `"Dog"`를 그대로 반환합니다.**

### 예제 9-18

```js
"Cat" || "Dog"; // -> "Cat"
```

**설명:**

- 논리합(`||`) 연산자는 두 개의 피연산자 중 하나만 `true`로 평가되어도 `true`를 반환합니다.
- 피연산자 `"Cat"`은 Truthy 값으로 평가됩니다.
- 논리합 연산자는 **논리 연산의 결과를 결정한 첫 번째 피연산자인 문자열 `"Cat"`을 반환합니다.**

**핵심 개념:**

- **논리 연산의 결과를 결정하는 피연산자를 타입 변환하지 않고 그대로 반환합니다. 이를 단축 평가라고 합니다.**
- **단축 평가는 표현식을 평가하는 도중 평가 결과가 확정된 경우, 나머지 평가 과정을 생략하는 것을 말합니다.**

### 단축 평가 규칙

| 단축 평가 표현식      | 평가 결과  |
| --------------------- | ---------- |
| `true \|\| anything`  | `true`     |
| `false \|\| anything` | `anything` |
| `true && anything`    | `anything` |
| `false && anything`   | `false`    |

### 예제 9-19

```js
// 논리합(||) 연산자
"Cat" || "Dog"; // -> "Cat"
false || "Dog"; // -> "Dog"
"Cat" || false; // -> "Cat"

// 논리곱(&&) 연산자
"Cat" && "Dog"; // -> "Dog"
false && "Dog"; // -> false
"Cat" && false; // -> false
```

---

## 9.4.2 단축 평가를 활용한 조건문 대체

단축 평가를 사용하면 `if`문을 간결하게 대체할 수 있습니다.

### 논리곱(&&) 연산자로 if문 대체

**예제 9-20**

```js
var done = true;
var message = "";

// 기존 if문
if (done) {
  message = "완료";
}

// 단축 평가로 대체
message = done && "완료";
console.log(message); // 완료
```

### 논리합(||) 연산자로 if문 대체

**예제 9-21**

```js
var done = false;
var message = "";

// 기존 if문
if (!done) {
  message = "미완료";
}

// 단축 평가로 대체
message = done || "미완료";
console.log(message); // 미완료
```

### 삼항 조건 연산자로 if-else문 대체

**예제 9-22**

```js
var done = true;
var message = "";

// 기존 if-else문
if (done) {
  message = "완료";
} else {
  message = "미완료";
}
console.log(message); // 완료

// 삼항 조건 연산자로 대체
message = done ? "완료" : "미완료";
console.log(message); // 완료
```

---

## 9.4.3 단축 평가의 활용 사례

### 객체 프로퍼티 참조 시 에러 방지

**객체를 가리키기를 기대하는 변수가 `null` 또는 `undefined`가 아닌지 확인하고 프로퍼티를 참조할 때** 단축 평가가 유용하게 사용됩니다.

- 객체는 키와 값으로 구성된 프로퍼티의 집합입니다.
- 변수의 값이 객체가 아닌 `null` 또는 `undefined`인 경우, 객체의 프로퍼티를 참조하면 TypeError가 발생합니다.

**예제 9-23 (에러 발생)**

```js
var elem = null;
var value = elem.value; // TypeError: Cannot read property 'value' of null
```

**예제 9-24 (단축 평가로 에러 방지)**

```js
var elem = null;
// elem이 null이나 undefined와 같은 Falsy 값이면 elem으로 평가되고,
// elem이 Truthy 값이면 elem.value로 평가됩니다.
var value = elem && elem.value; // -> null
```

### 함수 매개변수 기본값 설정

**함수 매개변수에 기본값을 설정**할 때도 단축 평가가 유용합니다.

- 함수를 호출할 때 인수를 전달하지 않으면, 매개변수에 `undefined`가 할당됩니다.
- 단축 평가를 사용해 에러를 방지할 수 있습니다.

**예제 9-25**

```js
// 단축 평가를 사용한 매개변수의 기본값 설정
function getStringLength(str) {
  str = str || "";
  return str.length;
}

getStringLength(); // -> 0
getStringLength("hi"); // -> 2

// ES6의 매개변수 기본값 설정 (더 현대적인 방법)
function getStringLength(str = "") {
  return str.length;
}

getStringLength(); // -> 0
getStringLength("hi"); // -> 2
```

---

## 9.4.4 null 병합 연산자 (??)

ES11에서 도입된 null 병합 연산자 `??`는 `null` 또는 `undefined`인 경우에만 우항의 피연산자를 반환하고, 그렇지 않으면 좌항의 피연산자를 반환합니다.

### 예제 9-30

```js
// 좌항의 피연산자가 null 또는 undefined이면 우항의 피연산자를 반환하고,
// 그렇지 않으면 좌항의 피연산자를 반환합니다.
var foo = null ?? "default string";
console.log(foo); // "default string"
```

### null 병합 연산자 vs 논리합 연산자

**null 병합 연산자 `??`의 장점:**

- `||`(논리합 연산자)를 사용한 단축 평가는 좌항의 피연산자가 Falsy 값(`false`, `undefined`, `null`, `0`, `""`)이면 우항의 피연산자를 반환합니다.
- 하지만 `0`이나 `""`도 기본값으로서 유효할 수 있는데, 이 경우 예기치 않은 동작이 발생할 수 있습니다.

**예제 9-31 (논리합 연산자 사용)**

```js
// Falsy 값인 0이나 ''도 기본값으로서 유효하다면 예기치 않은 동작이 발생할 수 있습니다.
var foo = "" || "default string";
console.log(foo); // "default string" (빈 문자열이 유효한 값인데도 기본값이 할당됨)
```

**예제 9-32 (null 병합 연산자 사용)**

```js
// 좌항의 피연산자가 Falsy 값이라도 null 또는 undefined가 아니면 좌항의 피연산자를 반환합니다.
var foo = "" ?? "default string";
console.log(foo); // "" (빈 문자열이 유효한 값으로 인식됨)
```

**핵심 차이점:**

- `||` 연산자: Falsy 값(`false`, `0`, `""`, `null`, `undefined`)일 때 우항 반환
- `??` 연산자: `null` 또는 `undefined`일 때만 우항 반환
